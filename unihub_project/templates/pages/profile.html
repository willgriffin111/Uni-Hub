{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNI-HUB</title>
    <!-- Bootstrap CSS -->
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fontawesome CSS -->
    <script src="https://kit.fontawesome.com/c43d240003.js" crossorigin="anonymous"></script>

    <!-- style sheets CSS -->
    <link rel="stylesheet" href="{% static 'profile.css' %}">
    <link rel="stylesheet" href="{% static 'nav_footer.css' %}">

</head>
<body>
    <!-- header -->
    {% include '../includes/header.html' %}

    <!-- Student Profile Page -->
    <div class="container profile-container">
        <!-- Profile Header -->
        <div class="profile-header-simple">
            <div class="profile-photo-container">
                <img src="{% static 'bingus.jpg' %}" alt="Profile Photo" class="profile-photo">
            </div>
            <h1 class="profile-name">{{ user.first_name }} {{ user.last_name }}</h1>
            <p class="university-name">{{ user.university }}</p>
            <p class="degree-info">BSc, Computer Science</p>
            <button id="logout-button" class="btn btn-danger">Logout</button>
        </div>

        <!-- Main Content -->
        <div class="profile-content">
            <div class="row">
                <!-- Left Column -->
                <div class="col-md-4">
                    <!-- Personal Information Card -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3>About me</h3>
                            <button class="edit-btn">Edit</button>
                        </div>
                        <div class="card-body">
                            <div class="info-item">
                                <span class="label">Gender:</span>
                                <span class="value">Male</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Email:</span>
                                <span class="value">{{ user.email }}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Date of Birth:</span>
                                <span class="value">{{ user.dob }}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">Bio:</span>
                                <span class="value">Hey! I'm Alex, a Computer Science student who loves motorcycles and coding. Looking to connect with fellow riders and tech enthusiasts on campus.</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Links Card -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3>My Activities</h3>
                        </div>
                        <div class="card-body">
                            <ul class="quick-links">
                                <li><a href="#"><i class="fa-solid fa-user"></i> Friends</a></li>
                                <li><a href="#"><i class="fa-solid fa-user-group"></i> Communities</a></li>
                                <li><a href="#"><i class="fa-solid fa-calendar-days"></i> Events</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-8">
                    <!-- Academic Progress Card -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3>Social Records</h3>
                        </div>
                        <div class="card-body">
                            <div class="progress-stats">
                                <div class="stat-item">
                                    <h4>Posts created</h4>
                                    <span class="stat-value">3</span>
                                </div>
                                <div class="stat-item">
                                    <h4>Events Attended</h4>
                                    <span class="stat-value">12</span>
                                </div>
                                <div class="stat-item">
                                    <h4>Friends</h4>
                                    <span class="stat-value">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Posts Card -->
                    <div class="profile-card">
                        <div class="card-header">
                            <h3>Recent Posts</h3>
                        </div>
                        <div class="card-body">
                            <div class="posts-list">
                                <!-- Post Item -->
                                {% for post in posts %}
                                    <div class="post-item">
                                        <div class="post-content">
                                            <h4>{{ post.title }}</h4>
                                            <p class="post-text">{{ post.content }}</p>
                                            {% if post.image %}
                                                <div class="post-image-container">
                                                    <img src="{{ post.image.url }}" alt="Post Image" class="post-image" onclick="openModal('{{ post.image.url }}')">
                                                </div>
                                            {% endif %}
                                            <div class="post-meta">
                                                <span class="post-date">Posted on {{ post.created_at|date:"F j, Y" }}</span>
                                                <span class="post-interactions">
                                                    <button class="like-button"><i class="fa-solid fa-heart"></i></button>
                                                    <span class="likes-counter">0</span>
                                                    <span class="likes-text">likes</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}

                                <!-- Modal for Image Popup -->
                                <div id="imageModal" class="modal">
                                    <div class="modal-content-wrapper">
                                        <span class="close" onclick="closeModal()">&times;</span>
                                        <img class="modal-content" id="fullImage">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- footer -->
    {% include '../includes/footer.html' %}

    <script>
        function openModal(imageSrc) {
            var modal = document.getElementById("imageModal");
            var modalImg = document.getElementById("fullImage");
            modal.style.display = "flex";  // Show modal
            modalImg.src = imageSrc;
        }
        
        function closeModal() {
            document.getElementById("imageModal").style.display = "none";
        }

        // Extract CSRF token from the cookie
        function getCSRFToken() {
            let cookieValue = null;
            if (document.cookie && document.cookie !== "") {
                const cookies = document.cookie.split(";");
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith("csrftoken=")) {
                        cookieValue = cookie.substring("csrftoken=".length, cookie.length);
                        break;
                    }
                }
            }
            return cookieValue;
        }
    
        document.getElementById("logout-button").addEventListener("click", async function() {
            const csrfToken = getCSRFToken();
            const response = await fetch("{% url 'api-logout' %}", {
                method: "POST",
                credentials: "include",  // Ensure session cookie is included
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "X-Requested-With": "XMLHttpRequest",
                    "X-CSRFToken": csrfToken  // Include CSRF token
                }
            });
            if (response.ok) {
                window.location.href = "/login/";  // Redirect to login page after logout
            } else {
                console.log("Logout failed:", response.statusText);
            }
        });
    </script>
</body>
</html>